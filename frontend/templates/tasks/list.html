<html>
<head>
{% load static %}
<link rel="stylesheet" href="{% get_static_prefix %}style.css" />
<script type="text/javascript" src="{% get_static_prefix %}jquery.min.js"></script>
<script type="text/javascript">
$('document').ready(function() {
    $('.cross_sub_button').live('click', function() {
        var id = $(this).attr('subtask_id')
        $.getJSON('cross_out_subtask/', { 'id': id }, function(data) {
            if (data['success']) {
                $('#subtask_'+id).removeClass('cross_sub_button').addClass('revive_sub_button')
                $('#subtask_'+id).siblings('span').addClass('cross_gray')
            }
        })
    })
    $('.revive_sub_button').live('click', function() {
        var id = $(this).attr('subtask_id')
        $.getJSON('revive_subtask/', { 'id': id }, function(data) {
            if (data['success']) {
                $('#subtask_'+id).removeClass('revive_sub_button').addClass('cross_sub_button')
                $('#subtask_'+id).siblings('span').removeClass('cross_gray')
            }
        })
    })
    $('.delete_sub_button').live('click', function() {
        var id = $(this).attr('subtask-id')
        $.getJSON('delete_subtask/', { 'id': id }, function(data) {
            if (data['success']) {
                $('#subtask_'+id+'_container').remove()
            }
        })
    })
});
</script>
</head>
<body>
<form action="add_task/" method="post">
    {% csrf_token %}
    <input type="text" name="new_task_name" maxlength="255" placeholder="nazwa zadania" size="60" autofocus="autofocus" />
    <input type="submit" value="Dodaj zadanie" />
    <input type="text" name="priority" maxlength="3" placeholder="priorytet" size="2" value="0" />
</form>

<hr />

{% if lista %}
<ol>
    {% for task in lista %}
    <div style="display: inline;">
    <li><form action="task_actions/" method="post">
        {% csrf_token %}
        <input type="hidden" name="task_id" value="{{ task.id }}" />
        <input type="submit" name="delete_task" class="delete_button" value="" title="usuń (wraz z podpunktami)" />
    {% if task.is_open %}
        <input type="submit" name="cross_out_task" value="" class="tick_button" title="skreśl (wraz z podpunktami)" />
        <span class="priority">({{ task.priority }}) </span><span>{{ task }}</span>
        <input type="text" name="new_subtask_name" placeholder="dodaj podpunkt" maxlength="255" size="50" />
        <input type="submit" name="add_subtask" value="" class="add_button" />
    {% else %}
        <input type="submit" name="revive_task" value="" class="revive_button" title="odkreśl" />
        <span class="priority">({{ task.priority }}) </span><span class="cross_gray">{{ task }}</span>
    {% endif %}
    </form></li>
    </div>
        {% for subtask in task.subtask_set.all %}
        <div id="subtask_{{ subtask.id }}_container" class="subtask_container">
            <button
                type="button"
                id="del_subtask_{{ subtask.id }}"
                subtask-id="{{ subtask.id }}"
                class="delete_sub_button"
                title="skreśl">
            </button>
            <button
                type="button"
                id="subtask_{{ subtask.id }}"
                subtask_id="{{ subtask.id }}"
                class="{% if subtask.is_open %}cross_sub_button{% else %}revive_sub_button{% endif %}"
                title="skreśl">
            </button>
            <span {% if not subtask.is_open %}class="cross_gray"{% endif %}>{{ subtask }}</span>
        </div>
        {% endfor %}
    {% endfor %}
</ol>
{% else %}
<p>Nie ma zadań</p>
{% endif %}
</body>
</html>
